<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Darkhall</title>
    <style>
        #messages {
            margin-top: 50px;
            width: 95%;
            padding-right: 5px;
            padding-bottom: 80px;
            word-break: break-word;
        }

        #bottom-bar {
            position: fixed;
            bottom: 0px;
            width: 100%;
            height: 50px;
            padding-top: 13px;
            left: 0px;
            background-color: #cacaca;
        }

        .chat-message {
            margin-top: 5px;
        }


        #chat {
            width: 80%;
            resize: none;
            margin-left: 5px;
        }

        #send {
            width: 38px;
            height: 39px;
            border-radius: 72px;
            background-color: red;
            border: none;
            margin-left: 7px;
        }

        #chat:active {
            border: none;
        }

        #send:active {
            border: none;
        }

        #header {
            position: fixed;
            width: 100%;
            height: 30px;
            background-color: black;
            top: 0px;
            left: 0px;
            color: white;
            text-align: center;
            padding-top: 9px;
        }
    </style>

</head>
<body>

    <div id="header"></div>
    <div id="messages" class="card-block"></div>

    <br>

    <div id="bottom-bar">
<textarea id="chat" name="inputMessage" maxlength="450"></textarea>
        <button id="send" class="btn"></button>
    </div>

</body>

<script src="gun.js"></script>
<script>
    var uid = Math.floor(Math.random() * 100000);

    gun = Gun(['https://rtnf-gun.herokuapp.com/gun']);
    copy = gun.get('test').get('chatlog');
    var chatLog
    var identify = false
    //copy.put(null)
    copy.on((data) => {
        console.log(data)
        try {
            


            chatLog = JSON.parse(data)
            console.log(chatLog[0])

            if (!identify) {
                var c = "<i>" + uid + " is entering this room..</i>"
                chatLog.push(c)
                copy.put(JSON.stringify(chatLog))
                identify = true
            }


            var mother = document.getElementById('messages')
            mother.innerHTML = ""
            chatLog.forEach(iter)

            function iter(v, i, a) {
                mother.innerHTML = mother.innerHTML + v +"<br>"
            }

          
        }
        catch (err) {
            chatLog = []
            var str = "<i>"+uid+" is entering this room for the first time..</i>"
            chatLog.push(str)
            copy.put(JSON.stringify(chatLog))

        }
        
   
    });


    const send = document.querySelector('#send')
    const input = document.querySelector('#chat')
    send.onclick = () => {
        var c = "<b>"+uid+"</b> : "+input.value
        chatLog.push(c)
        copy.put(JSON.stringify(chatLog))
        input.value = "";
        input.focus();

    
        
    };

    

    
    //paste.oninput = () => { copy.put(paste.value) };
    //copy.on((data) => { paste.value = data });</script>
